<!DOCTYPE html>
<html>
	<head>
		
	</head>
	
	<body>
		<div class="templateUser">
			<div class="panel">
				<div class="panel-heading" id="kopf">
					<h3 class="panel-title"></h3>
				</div>
				<div class="panel-body">
					<div class="well">
						<div id="id"></div>
						<div id="username"></div>
						<div id="email"></div>
						<div id="sprache"></div>
						<div id="tabelle_rollen"></div>
					</div>
				</div>
			</div>
		</div>
		
		<script>
			$
				.ajax({
					url : "/report/toverview/rest/router.php/user/id/USERID",
					context : document.body
				})
				.done(
						function(res) {
							directive = {
								'.panel-title' : function(a) {
									a = a.context;
									var userID = a.id;
									var vorname = a.firstname;
									var nachname = a.lastname;
									var userLink = "<a href='/user/profile.php?id=" + userID + "'>" + vorname
											+ " " + nachname + "</a>";
									
									return userLink;
								},
								/*
								'#kopf@style' : function (a) {
									var temp = "tu-darmstadt.de";
									var email = a.email;
									if(email.indexOf(temp) < 1) {
										return "background-color: #F5A300;";
									}
									else {
										return "background-color: #99A604;";
									}
								},
								*/
								'#id' : function(a) {
									a = a.context;
									return "User ID: " + a.id;
								},
								
								'#username' : function(a) {
									a = a.context;
									return "Benutzername: " + a.username;
								},
								
								'#email' : function (a) {
									a = a.context;
									var email = a.email;
									
									return "Email: " + "<a href='mailto:" + email + "'>" + email + "</a>";
								},
								
								'#sprache' : function (a) {
									a = a.context;
									var sprache = a.lang;
									
									return "Sprache: " + sprache;
								},
							};
							//console.log(res);
							var json = JSON.parse(res);
							$('div.templateUser')
									.render(json.Records, directive);
							// alert(res);
							console.log(json);
							a = json.Records.roles;
									var dataUser = new google.visualization.DataTable();
									dataUser.addColumn('number', 'ID');
									dataUser.addColumn('string', 'Semester');
									dataUser.addColumn('string', 'FB');
									dataUser.addColumn('string', 'Kurs');
									dataUser.addColumn('string', 'Rolle');
									var array = new Array();
									//console.log(result);
									$.each(a, function(id, felder) {
										//console.log(felder);
										var subarray = new Array();
										subarray.push(parseInt(felder.course));
										subarray.push(felder.semester);
										subarray.push(felder.fb);
										subarray.push(felder.fullname);
										subarray.push(felder.name);
										//data.addRow(array);
										//data.addRow('boolean', eigenschaften.bezeichnung);
										array.push(subarray);
									});
									dataUser.addRows(array);
									var tableUser = new google.visualization.Table(document.getElementById('tabelle_rollen'));
									tableUser.draw(dataUser, {
										showRowNumber : false
									});
									
									// Setup listener
									google.visualization.events.addListener(tableUser, 'select', selectHandler);
							
									// Select Handler. Call the table's getSelection() method
									function selectHandler() {
										var selection = tableUser.getSelection();
										$
											.ajax({
												url : "/report/toverview/html/detailed_course_view.html",
												context : document.body,
												success: function (inhalt) {
													var x = dataUser.getValue(selection[0].row, 0);
													var find = "#ID#";
													var regex = new RegExp(find, 'g');
													//console.log(regex);
													inhalt = inhalt.replace(regex, x);
													//console.log(inhalt);
													$( "#getCourse").html(inhalt);
													$("#tabs").tabs({active: 0});
												}
											});
										/*
										//alert("That's row " + data.getValue(selection[0].row, 0))
										$.get("/report/toverview/html/detailed_course_view.html", function( inhalt ) {
											var x = data.getValue(selection[0].row, 0);
											console.log("X: " + x);
											inhalt = inhalt.replace("/#ID#/g", x);
											console.log(inhalt);
											$( "#getCourse").html(inhalt);
											//$("#tabs").tabs({active: 0});
											//$('body,html').animate({scrollTop:0},800);
										});
										*/
									}

									
						});
		</script>
	</body>
</html>