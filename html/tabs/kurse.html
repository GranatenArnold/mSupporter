<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="https://www.google.com/jsapi"></script>
 		<!-- Create table -->
		<script type="text/javascript">
		
			function KurstabelleZeichnen(suchstring) {
				$('#courses').html(loader);
				$.ajax({
					url: "/report/toverview/rest/router.php/course/?query=" + suchstring,
					dataType: 'json',
				}).done(function (result) {
					// Create and populate the data table.
					var data = new google.visualization.DataTable();
					data.addColumn('number', 'ID');
			        data.addColumn('string', 'Semester');
			        data.addColumn('string', 'FB');
			        data.addColumn('string', 'Name');
			        var array = new Array();
			        result = result.Records;
			        //console.log(result);
        	    	$.each(result, function(id, felder) {
        	    		//console.log(felder);
        	    		
        	    		var subarray = new Array();
        	    		subarray.push(parseInt(felder.id));
        	    		subarray.push(felder.semester);
        	    		subarray.push(felder.fb);
        	    		subarray.push(felder.fullname);
        	    		//data.addRow(array);
        				//data.addRow('boolean', eigenschaften.bezeichnung);
        				array.push(subarray);
        			});
        	    	data.addRows(array);
        	    	
        	    	// Create and draw the visualization.
			        var table = new google.visualization.Table(document.getElementById('courses'));
			        table.draw(data, {showRowNumber: false});
			        
			        // Setup listener
			        google.visualization.events.addListener(table, 'select', selectHandler);
			        
			        // Select Handler. Call the table's getSelection() method
			        function selectHandler() {
			        	var selection = table.getSelection();
			        	//alert("That's row " + data.getValue(selection[0].row, 0))
			        	$.get("/report/toverview/html/detailed_course_view.html", function( inhalt ) {
			        		$( "#getCourse" ).html(loader);
	    					var x = data.getValue(selection[0].row, 0);
	    					//console.log(x);
	    					inhalt = inhalt.replace(/#ID#/g, x);
	    					//console.log(inhalt);
	    					$( "#getCourse" ).html(inhalt);
	    					$('body,html').animate({scrollTop:0},800);
			        	});
			        }
				})
			};
			/*
			// Load the Visualization API and the controls package.
		    google.load('visualization', '1.0', {'packages':['controls']});

		    // Set a callback to run when the Google Visualization API is loaded.
		    google.setOnLoadCallback(drawDashboard);

		    // Callback that creates and populates a data table,
		    // instantiates a dashboard, a range slider and a pie chart,
		    // passes in the data and draws it.
		    function drawDashboard(suchstring) {
		    	$('#courses').html(loader);
				$.ajax({
					url: "/report/toverview/rest/router.php/course/?query=" + suchstring,
					dataType: 'json',
				}).done(function (result) {
					// Create and populate the data table.
					var data = new google.visualization.DataTable();
					data.addColumn('number', 'ID');
			        data.addColumn('string', 'Semester');
			        data.addColumn('string', 'FB');
			        data.addColumn('string', 'Name');
			        var array = new Array();
			        result = result.Records;
			        //console.log(result);
        	    	$.each(result, function(id, felder) {
        	    		//console.log(felder);
        	    		
        	    		var subarray = new Array();
        	    		subarray.push(parseInt(felder.id));
        	    		subarray.push(felder.semester);
        	    		subarray.push(felder.fb);
        	    		subarray.push(felder.fullname);
        	    		//data.addRow(array);
        				//data.addRow('boolean', eigenschaften.bezeichnung);
        				array.push(subarray);
        			});
        	    	data.addRows(array);
				
        	    	

		        	// Create a dashboard.
		        	var dashboard = new google.visualization.Dashboard(document.getElementById('dashboard_div'));

		        	// Create a category picker, passing some options
		        	var categoryPicker = new google.visualization.ControlWrapper({
		        	  'controlType': 'CategoryFilter',
		        	  'containerId': 'filter_div',
		        	  'options': {
		        	    'filterColumnLabel': 'Name'
		        	  }
		        	});
		        	
		        	// Create a category picker, passing some options
		        	var categoryPicker2 = new google.visualization.ControlWrapper({
		        	  'controlType': 'CategoryFilter',
		        	  'containerId': 'filter_div2',
		        	  'options': {
		        	    'filterColumnLabel': 'FB'
		        	  }
		        	});
					
		        	// Create and draw the visualization.
			        var table = new google.visualization.ChartWrapper({
			        	'chartType': 'DataTable',
			            'containerId': 'chart_div'
			        });
			        //table.draw(data, {showRowNumber: false});
			        
		        	// Create a pie chart, passing some options
		        	/*var pieChart = new google.visualization.ChartWrapper({
		        	  'chartType': 'PieChart',
		        	  'containerId': 'chart_div',
		        	  'options': {
		        	    'width': 300,
		        	    'height': 300,
		        	    'pieSliceText': 'value',
		        	    'legend': 'right'
		        	  }
		        	});

		        	// Establish dependencies, declaring that 'filter' drives 'pieChart',
		        	// so that the pie chart will only display entries that are let through
		        	// given the chosen slider range.
		        	dashboard.bind(categoryPicker, table);
		        	dashboard.bind(categoryPicker2, table);

		        	// Draw the dashboard.
		        	dashboard.draw(data);
		    	})
		    };*/

			
	    	$(document).ready(function () {
	    		
	    		// Define a delay function to delay the database request for the search box.
	    		var delay = (function(){
	    			var timer = 0;
	    			return function(callback, ms){
	    				clearTimeout (timer);
	    				timer = setTimeout(callback, ms);
	    			};
	    		})();
	    		
	    		// Implement it into the search box.
    			$( "#search" ).keyup(function() {
    				value = $(this).val();
    				delay(function(){
    					//drawDashboard(value);
    					KurstabelleZeichnen(value);
    					}, 300); // Delay time can be set here (ms)
    			});
        	});
		</script>
	</head>

	<body>
		<div class="row">
			<div class="col-md-6">
				<div class="panel panel-default">
		            <div class="panel-heading">
		              <h3 class="panel-title">
		              	<div class="row">
		              		<div class="col-md-2">Kurs suchen:</div>
		              		<div class="col-md-3"><input id="search"></input></div>
		              		<div class="col-md-7" id="dashboard_div">
		              			<div class="row">
		              				<div class="col-md-6" id="filter_div"></div>
		              				<div class="col-md-6" id="filter_div2"></div>
		              			</div>
		              		</div>
		              	</div>
		            </div>
		            <div class="panel-body" id="courses">
		            </div>
		          </div>
	    	</div>
	    	<div class="col-md-6">
				<div id = "getCourse"></div>
		</div>
	</body>
</html>