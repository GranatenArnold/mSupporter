<!DOCTYPE html>
<html>
	<head>
 		<!-- Create table -->
		<script type="text/javascript">
		
			function KurstabelleZeichnen(suchstring) {
				$('#courses').html(loader);
				$.ajax({
					url: "/report/toverview/rest/router.php/course/?query=" + suchstring,
					dataType: 'json',
				}).done(function (result) {
					// Create and populate the data table.
					var data = new google.visualization.DataTable();
					data.addColumn('number', 'ID');
			        data.addColumn('string', 'Semester');
			        data.addColumn('string', 'FB');
			        data.addColumn('string', 'Name');
			        var array = new Array();
			        result = result.Records;
			        //console.log(result);
        	    	$.each(result, function(id, felder) {
        	    		//console.log(felder);
        	    		
        	    		var subarray = new Array();
        	    		subarray.push(parseInt(felder.id));
        	    		subarray.push(felder.semester);
        	    		subarray.push(felder.fb);
        	    		subarray.push(felder.fullname);
        	    		//data.addRow(array);
        				//data.addRow('boolean', eigenschaften.bezeichnung);
        				array.push(subarray);
        			});
        	    	data.addRows(array);
        	    	
        	    	// Create and draw the visualization.
			        var table = new google.visualization.Table(document.getElementById('courses'));
			        table.draw(data, {showRowNumber: false});
			        
			        // Setup listener
			        google.visualization.events.addListener(table, 'select', selectHandler);
			        
			        // Select Handler. Call the table's getSelection() method
			        function selectHandler() {
			        	var selection = table.getSelection();
			        	//alert("That's row " + data.getValue(selection[0].row, 0))
			        	$.get("/report/toverview/html/detailed_course_view.html", function( inhalt ) {
			        		$( "#getCourse" ).html(loader);
	    					var x = data.getValue(selection[0].row, 0);
	    					//console.log(x);
	    					inhalt = inhalt.replace(/#ID#/g, x);
	    					//console.log(inhalt);
	    					$( "#getCourse" ).html(inhalt);
	    					$('body,html').animate({scrollTop:0},800);
			        	});
			        }   
				});
			}
			
	    	$(document).ready(function () {
	    		
	    		// Define a delay function to delay the database request for the search box.
	    		var delay = (function(){
	    			var timer = 0;
	    			return function(callback, ms){
	    				clearTimeout (timer);
	    				timer = setTimeout(callback, ms);
	    			};
	    		})();
	    		
	    		// Implement it into the search box.
    			$( "#search" ).keyup(function() {
    				value = $(this).val();
    				delay(function(){
    					KurstabelleZeichnen(value);
    					}, 300); // Delay time can be set here (ms)
    			});
        	});
		</script>
	</head>

	<body>
		<div class="row">
			<div class="col-md-6">
				<div class="panel panel-default">
		            <div class="panel-heading">
		              <h3 class="panel-title">
		              	<div class="row">
		              		<div class="col-md-2">Kurs suchen:</div>
		              		<div class="col-md-10"><input id="search"></input></div>
		              	</div>
		            </div>
		            <div class="panel-body" id="courses">
		            </div>
		          </div>
	    	</div>
	    	<div class="col-md-6">
				<div id = "getCourse"></div>
		</div>
	</body>
</html>